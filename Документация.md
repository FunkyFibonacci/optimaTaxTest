# Документация API для системы расчета налогов

## 1. Введение
В процессе выполнения тестового задания мне пришлось изучить основы **GraphQL API**, с которым я раньше не работал. Это оказалось мощным и удобным инструментом для работы с данными через API. Особенно мне понравился веб-интерфейс для тестирования запросов, который аналогичен **Swagger**, что значительно упрощает взаимодействие с API.

В рамках этого задания я реализовал минимально необходимый функционал, соответствующий требованиям задачи, используя **GraphQL**. Данная документация описывает API системы расчета налогов, разработанной для управления данными о странах, категориях доходов и налоговых ставках, а также для расчета налогов и генерации отчетов, соответствующих требованиям местного законодательства.

## 2. Общая информация
Система предоставляет функционал для управления следующими данными:
- **Страны** (с их кодами и форматами отчетов);
- **Категории доходов**;
- **Налоговые ставки**;
- **Доходы пользователей**.

Все операции выполняются через **GraphQL API**, что позволяет удобно запрашивать данные и выполнять мутации для их управления.

## 3. Технологии
- **Язык программирования**: Java 17
- **Фреймворк**: Spring Boot (с использованием **Spring Data JPA** и **Spring Security**)
- **СУБД**: PostgreSQL
- **Инструменты тестирования**: JUnit, Mockito
- **API**: **GraphQL**, **REST** для создания пользователей
- **DTO**: реализованы через **record**

## 4. Методы API

### 4.1 Пользователи

**Запросы**:
- `getAllUsers`: Возвращает список всех пользователей.  
  **Возвращаемые данные**: Поля пользователя (имя, фамилия, логин, роль).

### 4.2 Страны

**Запросы**:
- `getAllCountries`: Возвращает список всех стран.
- `getCountryById(id: ID)`: Возвращает данные о стране по её ID.
- `getCountryByName(name: String)`: Возвращает данные о стране по её названию.

**Мутации**:
- `addCountry(input: CountryInput!)`: Добавляет новую страну.  
  **Поля**: ID, название, код, формат отчета, даты создания и обновления.

### 4.3 Категории доходов

**Запросы**:
- `getAllCategories`: Возвращает список всех категорий доходов.
- `getIncomeCategoryById(id: ID)`: Возвращает категорию доходов по её ID.
- `getIncomeCategoryByName(name: String)`: Возвращает категорию доходов по её названию.

**Мутации**:
- `addIncomeCategory(input: IncomeCategoryInput!)`: Добавляет новую категорию доходов.

### 4.4 Налоговые ставки

**Запросы**:
- `getTaxRatesOfCountries`: Возвращает список налоговых ставок для всех стран.

**Мутации**:
- `addTaxRate(input: TaxRateInput!)`: Добавляет новую налоговую ставку.
- `updateTaxRate(input: TaxRateInput!)`: Обновляет существующую налоговую ставку.

### 4.5 Доходы пользователей

**Мутации**:
- `addIncome(input: UserIncomeInput!)`: Добавляет доход пользователя.  
  **Поля**: ID, категория доходов, сумма, пользователь, даты создания и обновления.

### 4.6 Отчеты

**Запросы**:
- `generateReportByCountryId(countryId: ID!)`: Генерирует отчет для указанной страны.  
  Отчеты отличаются по форматам в зависимости от страны:
    - **США**: детализированный отчет по категориям доходов;
    - **Германия**: общий отчет с итоговыми суммами доходов и налогов;
    - **Франция**: отчет с итогами по категориям и подписью инспектора.

## Заключение
Данная документация предоставляет описание **API** для управления данными и расчета налогов. Для тестирования API предусмотрена **Postman-коллекция**, которая прилагается к проекту.

